## MySQL体系结构和存储引擎

### 定义数据库和实例

+ **数据库**：物理操作系统文件或其他形式文件类型的集合。在MySQL数据库中，数据库文件可以是frm、MYD、MYI、ibd结尾的文件。

+ **实例**：MySQL数据库由后台线程以及一个共享内存区组成。共享内存可以被运行的后台线程所共享。数据库实例才是真正用于操作数据库文件的。

  &emsp;在MySQL数据库中，实例与数据库的关系通常是一一对应的，即一个实例对应一个数据库，一个数据库对应一个实例。但是，在集群情况下可能存在一个数据库被多个数据实例使用的情况。

  &emsp;MySQL是一个单进程多线程架构的数据库，也就是说，MySQL数据库实例在系统上的表现就是一个进程。当启动实例时，MySQL数据库会去读取配置文件，根据配置文件的参数来启动数据库实例。在MySQL数据库中，可以没有配置文件，在这种情况下，MySQL会按照编译时的默认参数启动实例。如果在多个配置文件中都有同一个参数，MySQL会以读取到的最后一个配置文件中的参数为准。

  ### MySQL体系结构

  ![1569726464629](C:\Users\施文波\AppData\Roaming\Typora\typora-user-images\1569726464629.png)

  

  &emsp;从图中可以看出，MySQL由以下几部分组成：

  + 连接池组件
  + 管理服务和工具组件
  + SQL接口组件
  + 查询分析器组件
  + 优化器组件
  + 缓冲组件
  + 插件式存储引擎
  + 物理文件

  &emsp;MySQL数据库区别于其他数据库的最重要一个特点就是其插件式的表存储引擎。

  &emsp;**存储引擎是基于表的，而不是数据库。**

  ### MySQL存储引擎

  #### InnoDB存储引擎

  &emsp;InnoDB存储引擎支持事务，其设计目标主要面向在线事务处理（OLTP）的应用。其特点是行锁设计、支持外键、并支持非锁定读，即默认读取操作不会产生锁。从MySQL数据库5.5.8版本开始，InnoDB存储引擎是默认的存储引擎。

  &emsp;InnoDB存储引擎将数据放在一个逻辑的表空间中，InnoDB通过使用多版本并发控制（MVCC)来获得高并发性，并且实现了SQL标准的4种隔离级别，默认为REPETABLE级别。同时，使用一种被成为next-key locking的策略来避免幻读的产生。除此之外，InnoDB存储引擎还提供了插入缓冲、二次写、自适应哈希索引、预读等高性能和高可用的功能。

  &emsp;对于表中数据的存储，InnoDB存储引擎采用了聚集（clustered）的方式，因此每张表的存储都是按主键的顺序进行存放。如果没有显式地在表定义时指定主键，InnoDB存储引擎会为每一行生成一个6字节的ROWID，并以此为主键。

  #### MyISAM存储引擎

  &emsp;MyISAM存储引擎不支持事务、表锁设计、支持全文索引、主要面向一些OLAP数据库应用。它的缓冲池只缓存索引文件，而不缓冲数据文件。

  &emsp;MyISAM存储引擎表由MYD和MYI组成，MYD用来存放数据文件，MYI用来存放索引文件。

  #### NDB存储引擎

  &emsp;NDB存储引擎是一个集群存储引擎，其结构是share nothing的集群架构。NDB的特点是数据全部放在内存中，因此主键查找的速度极快，并且通过添加NDB数据存储节点可以线性地提高数据库性能，是高可用、高性能地集群系统。

  &emsp;NDB存储引擎的连接操作（JOIN_）是在MySQL数据库层完成的，而不是在存储引擎层完成的。这意味着，复杂的连接操作需要巨大的网络开销，因此查询速度很慢。

  #### Memory存储引擎

  &emsp;Memory存储引擎将表中的数据存放在内存中，如果数据库重启或发生崩溃，表中的数据都将消失。它非常适合用于存储临时数据的临时表，以及数据仓库中的纬度表。Memory存储引擎默认使用哈希索引，而不是我们熟悉的B+树索引。

  &emsp;Memory存储引擎只支持表锁，并发性能较差，并且不支持TEXT和BLOB列类型。存储变长字段（varchar）时是按照定长字段(char)的方式进行的，因此会浪费内存。

  &emsp;MySQL数据库使用Memory存储引擎作为临时表来存放查询的中间结果集。如果中间结果集大于Memory存储引擎表的容量设置，又或者中间结果含有TEXT或BLOB列类型字段，则MySQL数据库会把其转换到MyISAM存储引擎表而存放到磁盘中。因为MyISAM不缓存数据文件，因此这时产生的临时表的性能对于查询会有损失。

  #### Archive存储引擎

  &emsp;Archive存储引擎只支持INSERT和SELECT操作，从MySQL5.1开始支持索引。Archive存储引擎使用z'lib算法将数据行（raw）进行压缩后存储，压缩比一般可达1：10。Archive存储引擎非常适合存储归档数据，如日志信息。Archive存储引擎使用行锁来实现高并发的插入操作，但是其本身并不是事务安全的存储引擎，其设计目标主要是提供高速的插入和压缩功能。

  #### Federated存储引擎

  &emsp;Federated存储引擎表并不存放数据，它只是指向一台远程MySQL数据库服务器中的表。Federated存储引擎表支持MySQL数据库表，不支持异构数据库表。

  #### Maria存储引擎

  &emsp;Maria存储引擎的特点是：支持缓存数据和索引文件，应用了行锁设计，提供了MVCC功能，支持事务和非事务安全的选项，以及更好的BLOB字符类型的处理性能。

  #### 其他存储引擎

  &emsp;如Merge、CSV、Sphinx和Infobright。

  ### 各存储引擎之间的比较

  ![1569738654204](C:\Users\施文波\AppData\Roaming\Typora\typora-user-images\1569738654204.png)

  ### 连接MySQL

  #### TCP/IP

  &emsp;TCP/IP套接字方式是MySQL数据库在任何平台下都提供的连接方式，也是网络中使用得最多的一种方式。

  #### 命名管道和共享内存

  &emsp;如果两个需要进程通信的进程在同一台服务器上，那么可以使用命名管道，在MySQL数据库中须在配置文件中启用--enable-named-pipe选项。

  &emsp;在MySQL4.1之后的版本中，MySQL还提供了共享内存的连接方式，这是通过在配置文件中添加--shared--memory实现的。如果想使用共享内存的方式，在连接时，MySQL客户端还必须使用--protocol=memory选项。

  ### UNIX域套接字

  &emsp;在Linux和UNIX环境下，还可以使用UNIX域套接字。UNIX域套接字不是一个网络协议，所以智能在MySQL客户端和数据库实例在一台服务器上的情况下使用。

  

  

  

  

  

  

  

  